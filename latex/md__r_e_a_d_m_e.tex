\chapter{Arm Cortex-\/\+M0 Base Project}
\hypertarget{md__r_e_a_d_m_e}{}\label{md__r_e_a_d_m_e}\index{Arm Cortex-\/M0 Base Project@{Arm Cortex-\/M0 Base Project}}
\label{md__r_e_a_d_m_e_autotoc_md0}%
\Hypertarget{md__r_e_a_d_m_e_autotoc_md0}%
 Example Workspace für die Vorlesung Systemnahe Programmierung II an der DHWB Ravensburg.\hypertarget{md__r_e_a_d_m_e_autotoc_md1}{}\doxysection{\texorpdfstring{Arm Documentation}{Arm Documentation}}\label{md__r_e_a_d_m_e_autotoc_md1}

\begin{DoxyItemize}
\item \href{https://developer.arm.com/Processors/Cortex-M0}{\texttt{ Cortex M0 Startseite}}
\begin{DoxyItemize}
\item \href{https://developer.arm.com/documentation/ddi0419/latest/}{\texttt{ Armv6-\/M Architecture Reference Manual}}
\item \href{https://developer.arm.com/documentation/102834/0100/?lang=en}{\texttt{ Arm Cortex-\/\+M0 Processor Datasheet}}
\item \href{https://developer.arm.com/documentation/dui0497/a/?lang=en}{\texttt{ Cortex-\/\+M0 Devices Generic User Guide}}
\item \href{https://developer.arm.com/documentation/ddi0432/c/?lang=en}{\texttt{ Cortex-\/\+M0 Technical Reference Manual r0p0}}
\end{DoxyItemize}
\item \href{https://github.com/ARM-software/abi-aa}{\texttt{ Arm Application Binary Interface}}
\item \href{https://sourceware.org/binutils/docs-2.40/as/index.html}{\texttt{ GNU Assembler Documentation}}
\item \href{https://sourceware.org/binutils/docs-2.40/ld/index.html}{\texttt{ GNU Linker Documentation}}
\end{DoxyItemize}\hypertarget{md__r_e_a_d_m_e_autotoc_md2}{}\doxysection{\texorpdfstring{Simuliertes Board Info}{Simuliertes Board Info}}\label{md__r_e_a_d_m_e_autotoc_md2}

\begin{DoxyItemize}
\item \href{https://www.qemu.org/docs/master/system/arm/nrf.html}{\texttt{ Nordic n\+RF boards (microbit)}}
\item \href{https://www.nordicsemi.com/products/nrf51822}{\texttt{ Nordic n\+RF51822}}
\item \href{https://infocenter.nordicsemi.com/pdf/nRF51822_PS_v3.4.pdf}{\texttt{ n\+RF51822 Product Specification v3.\+4}}
\end{DoxyItemize}\hypertarget{md__r_e_a_d_m_e_autotoc_md3}{}\doxysection{\texorpdfstring{Prerequisites}{Prerequisites}}\label{md__r_e_a_d_m_e_autotoc_md3}

\begin{DoxyItemize}
\item Arm Cross Compiler Paket\+: {\itshape gcc-\/arm-\/none-\/eabi}
\item QEMU Arm Paket\+: {\itshape qemu-\/system-\/arm}
\item GDB (Multi-\/\+Arch) Paket\+: {\itshape gdb-\/multiarch}
\item CMake
\end{DoxyItemize}

Hinweis\+: Bei SUSE scheint der standard GDB ein GDB-\/\+Multiarch zu sein.\hypertarget{md__r_e_a_d_m_e_autotoc_md4}{}\doxysubsection{\texorpdfstring{Windows}{Windows}}\label{md__r_e_a_d_m_e_autotoc_md4}
Installation von CMake über Download des Installers (\href{https://cmake.org/download/}{\texttt{ https\+://cmake.\+org/download/}}) oder Paketmanager {\ttfamily winget install CMake.\+CMake}.

Installation der ARM GCC Toolchain \href{https://gnutoolchains.com/arm-eabi/}{\texttt{ Website}} Nach z.\+B. C\+:\textbackslash{}\+Toolchains\textbackslash{} {\bfseries{WICHTIG\+:}} zu PATH hinzufügen (lassen)\hypertarget{md__r_e_a_d_m_e_autotoc_md5}{}\doxysubsection{\texorpdfstring{Linux}{Linux}}\label{md__r_e_a_d_m_e_autotoc_md5}
Über Paketmanager Installieren\+:

{\bfseries{Ubuntu/ Debian}}\+: {\ttfamily sudo apt install gcc-\/arm-\/none-\/eabi cmake}

{\bfseries{Arch}}\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{yay\ -\/S\ gcc-\/arm-\/none-\/eabi-\/bin\ }
\DoxyCodeLine{sudo\ pacman\ -\/S\ cmake}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md6}{}\doxysubsection{\texorpdfstring{mac\+OS}{mac\+OS}}\label{md__r_e_a_d_m_e_autotoc_md6}

\begin{DoxyCode}{0}
\DoxyCodeLine{install\ gcc-\/arm-\/embedded\ cmake}

\end{DoxyCode}
 \hypertarget{md__r_e_a_d_m_e_autotoc_md7}{}\doxysubsubsection{\texorpdfstring{Apple Silicon}{Apple Silicon}}\label{md__r_e_a_d_m_e_autotoc_md7}

\begin{DoxyCode}{0}
\DoxyCodeLine{install\ arm-\/none-\/eabi-\/gdb}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md8}{}\doxysection{\texorpdfstring{Building}{Building}}\label{md__r_e_a_d_m_e_autotoc_md8}
Auschecken des Quellcodes\+: {\ttfamily git clone \href{https://github.com/infohoschie/arm-cortex-m0-c-cmake.git}{\texttt{ https\+://github.\+com/infohoschie/arm-\/cortex-\/m0-\/c-\/cmake.\+git}}}

Erstellen des Build Mittels CMake Presets\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{-\/-\/preset\ arm-\/cortex-\/m0-\/unix}

\end{DoxyCode}
 oder 
\begin{DoxyCode}{0}
\DoxyCodeLine{-\/-\/preset\ arm-\/cortex-\/m0-\/mingw}

\end{DoxyCode}


Bauen Mittels CMake Presets\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{-\/-\/build\ -\/-\/preset\ arm-\/cortex-\/m0-\/unix}

\end{DoxyCode}
 oder 
\begin{DoxyCode}{0}
\DoxyCodeLine{-\/-\/build\ -\/-\/preset\ arm-\/cortex-\/m0-\/mingw}

\end{DoxyCode}
\hypertarget{md__r_e_a_d_m_e_autotoc_md9}{}\doxysection{\texorpdfstring{Generiertes Output analysieren (optional)}{Generiertes Output analysieren (optional)}}\label{md__r_e_a_d_m_e_autotoc_md9}

\begin{DoxyItemize}
\item ELF-\/\+Sections anzeige\+: {\ttfamily arm-\/none-\/eabi-\/objdump -\/x build-\/cortex-\/m0/test\+App.\+elf}
\item ELF-\/\+File disassemblieren (mit Quellcode-\/\+Verknüpfung)\+: {\ttfamily arm-\/none-\/eabi-\/objdump -\/d build-\/cortex-\/m0/test\+App.\+elf} {\ttfamily arm-\/none-\/eabi-\/objdump -\/d -\/S build-\/cortex-\/m0/test\+App.\+elf}
\end{DoxyItemize}\hypertarget{md__r_e_a_d_m_e_autotoc_md10}{}\doxysection{\texorpdfstring{QEMU Emulator starten und mit GDB verbinden}{QEMU Emulator starten und mit GDB verbinden}}\label{md__r_e_a_d_m_e_autotoc_md10}
QEMU und GDB müssen in unterschiedlichen Konsolen (Shells) gestartet werden. \hypertarget{md__r_e_a_d_m_e_autotoc_md11}{}\doxysubsection{\texorpdfstring{-\/ QEMU Emulation Starten\+:}{-\/ QEMU Emulation Starten\+:}}\label{md__r_e_a_d_m_e_autotoc_md11}
{\ttfamily qemu-\/system-\/arm -\/M microbit -\/device loader,file=build-\/cortex-\/m0/test\+App.\+elf -\/nographic -\/S -\/s -\/serial mon\+:stdio} \hypertarget{md__r_e_a_d_m_e_autotoc_md12}{}\doxysubsection{\texorpdfstring{-\/ GDB zu QEMU verbinden\+:}{-\/ GDB zu QEMU verbinden\+:}}\label{md__r_e_a_d_m_e_autotoc_md12}
{\ttfamily gdb-\/multiarch build-\/cortex-\/m0/test\+App.\+elf -\/ex "{}target extended-\/remote localhost\+:1234"{} -\/ex "{}load"{}} \hypertarget{md__r_e_a_d_m_e_autotoc_md13}{}\doxysubsubsection{\texorpdfstring{Mac\+OS on Apple Silicon\+:}{Mac\+OS on Apple Silicon\+:}}\label{md__r_e_a_d_m_e_autotoc_md13}
{\ttfamily arm-\/none-\/eabi-\/gdb build-\/cortex-\/m0/test\+App.\+elf -\/ex "{}target extended-\/remote localhost\+:1234"{} -\/ex "{}load"{}}

Um QEMU zu beenden die Tastenkombination {\ttfamily \texorpdfstring{$<$}{<}strg\texorpdfstring{$>$}{>} + a} und anschließend {\ttfamily x} nutzen.\hypertarget{md__r_e_a_d_m_e_autotoc_md14}{}\doxysection{\texorpdfstring{IDEs}{IDEs}}\label{md__r_e_a_d_m_e_autotoc_md14}
\hypertarget{md__r_e_a_d_m_e_autotoc_md15}{}\doxysubsection{\texorpdfstring{Jetbrains CLion}{Jetbrains CLion}}\label{md__r_e_a_d_m_e_autotoc_md15}
Das Projekt kann direkt in der IDE geöffnet (ausgecheckt) werden. Die CMake Presets werden direkt als build-\/target angeboten

Der integrierte Debugger kann direkt genutzt werden. Unter der Run-\/\+Configuration kann der QEMU Aufruf als "{}\+Native Application"{} hinzugefügt werden. Unter debug Configuration kann eine "{}\+Remote Debug"{} Konfiguration angelegt werden, bei der unter "{}target remote args"{} die Verbindungsdetails angeben und als {\itshape symbol file} die {\itshape test\+App.\+elf} referenziert werden kann.\hypertarget{md__r_e_a_d_m_e_autotoc_md16}{}\doxysubsection{\texorpdfstring{Visual Studio Code}{Visual Studio Code}}\label{md__r_e_a_d_m_e_autotoc_md16}
Folgende Extensions werden benötigt\+:
\begin{DoxyItemize}
\item jkearins.\+action-\/buttons-\/ext
\item webfreak.\+debug
\item maxmitti.\+cmake-\/tools-\/fork
\item twxs.\+cmake
\item dan-\/c-\/underwood.\+arm
\end{DoxyItemize}

Diese sind ebenfalls als empfohlene Extensions im Workspace definiert.

Nach Installation erkennt VScode die CMake Presets und bietet diese gleich an. Ebenfalls wird in der Statusleiste ein Button {\bfseries{Start Qemu}} hinzugefügt, über diesen die QEmu-\/\+Session (also unser Target) gestartet werden kann.\hypertarget{md__r_e_a_d_m_e_autotoc_md17}{}\doxysubsubsection{\texorpdfstring{Wichtig\+:}{Wichtig\+:}}\label{md__r_e_a_d_m_e_autotoc_md17}
Zwischen der Extension \href{https://marketplace.visualstudio.com/items?itemName=maxmitti.cmake-tools-fork}{\texttt{ maxmitti.\+cmake-\/tools-\/fork}} und \href{https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools}{\texttt{ ms-\/vscode.\+cmake-\/tools}} kommt es zu Konflikten. Wichtig in diesem Projekt ist, dass der "{}\+Build"{}-\/Button in der Statusleiste nicht funktioniert, wenn beide Extensions installiert sind. Deswegen sollte die Extension \href{https://marketplace.visualstudio.com/items?itemName=ms-vscode.cmake-tools}{\texttt{ ms-\/vscode.\+cmake-\/tools}} deaktiviert werden. 